<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cos.shop.repository.ReviewRepository">

  
  <insert id="save" useGeneratedKeys="true" keyProperty="id" parameterType="com.cos.shop.model.review.dto.ReqSaveDto">   	
  	insert into review(title, content, userId, productId)
  	values(#{title}, #{content}, #{userId},#{productId})
  </insert>
  
  <select id="findById" resultType="com.cos.shop.model.review.dto.RespReviewDto">
  	select r.id,r.productId,r.title,u.username,r.createDate from review r
  	inner join user u
  	on r.userId = u.id 
  	where r.id = #{reviewId} 
  </select>
  
   <select id="findContentById" resultType="com.cos.shop.model.review.dto.RespReviewContentDto">
  	select content 
  	from review
  	where id = #{reviewId} 
   </select>
     
  <select id="findAll" resultType="com.cos.shop.model.review.dto.RespReviewDto">
  	select r.id,r.productId,r.title,u.username,r.createDate from review r
  	inner join user u
  	on r.userId = u.id
  	where productId = #{productId} 
  	order by r.id desc limit #{page}, 10  	
  </select>
  
  <select id="setTotalCount"  resultType="int">
  	select count(*) from review where productId = #{productId} order by id desc
  
  </select>
  
  
</mapper>